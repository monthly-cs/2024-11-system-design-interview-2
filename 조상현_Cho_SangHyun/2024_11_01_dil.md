13 ~ 22p까지 읽음
### 1. Hash 기반 공간 인덱스 - 지오해시
격자를 4개로 분할한 뒤 01, 11, 00, 10의 비트값을 분할된 격자들에 할당하는데, 각 격자들을 다시 분할하여 같은 방법으로 비트를 붙여나갑니다. 마지막에 요 비트 문자열을 base32 표현법으로 변환한 문자열을 `지오해시`라고 부릅니다.
요 `지오해시`라고 불리는 문자열의 길이에 따라 분할된 격자들이 크기가 결정되고, 이는 `지오해시`의 정밀도가 결정됨을 의미합니다. 통상 자주 쓰이는 지오해시 길이는 4 ~ 6 사이로, 4는 39.1Km X 19.5km 사이즈로, 6은 1.2km X 609.4m로 격자의 크기가 정해집니다.
#### 가장자리 관련 이슈 1 - 가까이 있다고 지오해시값이 비슷하진 않음
격자를 분할하여 원래 격자가 가지던 비트값에 01, 11, 00, 10을 붙인 4개의 격자가 만들어지는 것이므로, 얘네들은 base32 표현법으로 변환된 문자열이 비슷할 수밖에 없습니다. 즉 `지오해시`는 공통 접두어가 긴 격자들이 서로 가깝게 있다는 특징을 가집니다. 따라서 "공통접두어가 긴 격자들은 가까이 있다"라는 명제는 성립하지만, 역으로 "가까이 있는 격자들은 공통접두어가 길다"는 성립하지 않습니다.

<img width="220" alt="image" src="https://github.com/user-attachments/assets/dd347cb8-a84c-4b7f-bc29-7caac340c696">


위 그림에서 빨간 테두리 내부의 격자들은 앞쪽에 공통적으로 01이 붙으나, 파란 테두리 내부의 격자들은 인접해있지만 앞쪽의 비트값들이 서로 다른 것을 볼 수 있습니다.

#### 가장자리 관련 이슈 2 - 공통 접두어 길이가 길어도 서로 다른 격자 가능
"지오해시값이 비슷하면 가까이 있다"라는 명제가 성립한다는 것은 공통 접두어 길이가 길어도 서로 다른 격자에 놓일 수 있음을 의미합니다. 이는 현재 격자를 비롯한 인접한 모든 격자의 사업장 정보를 가져오는 방식으로 해결 가능합니다. 지오해시 문자열을 다시 비트값으로 변환 후 끝쪽 비트값만 바꿔주면 인접한 격자 정보를 빠르게 가져올 수 있습니다. (균등 격자 방식에서 인접한 격자들의 정보를 가져오기 힘들던 것과 대조적)

#### 표시할 사업장이 충분치 않다면?
현재 격자에 만족할 만큼 공간 데이터들이 충분히 있지 않을 때, 지오해시는 끝쪽 비트값을 떼주기만 하면 검색 반경을 넓히는 효과를 줄 수 있습니다.

<br/>  


### 2. 트리 기반 공간 인덱스 - 쿼드트리(QuadTree)
격자를 특정 기준을 만족할 때까지(ex : 격자에 있는 공간 데이터가 100개 이하일 때까지) 사분할하며 트리를 만들면, 공간 데이터 검색 시 만들어둔 트리를 다음과 같이 사용할 수 있습니다. 

1. 루트노드의 자식 중 좌표값이 있는 사분면에 해당하는 노드로 탐색
2. 해당 노드의 자식 중 좌표값이 있는 사분면에 해당하는 노드로 탐색
3. 2를 반복(리프 노드 도착할 때까지)

이때 사용되는 트리를 쿼드트리라 부릅니다. 리프 노드들이 해당하는 격자 내부에 갖는 공간데이터들의 pk목록을 갖게 하는 식으로 구성하면, 원하는 좌표값 근처의 공간데이터들을 가져오게 하는 식으로 활용 가능합니다. 

<br/>  

### 3. 배포 방법들
책 22p에서 블루그린배포에 대한 내용이 나오는데요, 아무래도 배포 방법들에 대해 제가 잘 알지 못해 한 번 조사해봤습니다. 

#### 1) 블루그린 배포 (Blue-Green Deployment)
프로덕션 환경을 블루와 그린이라는 논리적인 영역들로 분류하고, 그린 영역에서 애플리케이션의 새로운 버전을 배포 & 테스트하다 문제가 없다면 트래픽을 그린으로 전환시키는 방법입니다. (문제 발생 시 블루로 다시 전환)

#### 2) 롤링배포 (Rolling Deployment)
서버들을 하나씩 새로운 버전으로 교체해나가는 방법입니다.

#### 3) 카나리 배포 (Canary Deployment)
신규 버전을 배포한 뒤, 일부 사용자만 신규 버전을 사용하게끔 트래픽을 조절하여 안정성과 성능을 모니터링하다가, 문제가 없다면 전체 사용자에게 점차적으로 확대 적용하는 방식입니다. 블루 그린은 확 틀어버린다는 느낌이라면 카나리는 간 보다가 조금씩 늘려가는 느낌으로 이해했습니다.
