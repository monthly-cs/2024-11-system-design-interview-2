~~44p

⛳️ 세줄 평!

1. 도메인에 대한 이해도를 먼저 묻자
2. 이후 CAP 정리, 목표 지연시간, 데이터 내구성 등을 묻자
3. 마지막으로 유저수 및 API 호출 수를 기반으로 개략적 규모 추정을 진행하자

# 1단계 문제 이해 및 설계 범위 확정

## 1.1. 접근 전략

가상 설계 면접을 `30분` 진행한다면, 1단계는 `5~7분` 할애할 것 같습니다.

이 시간 동안 `아키텍처 방향성`과 `트래픽 및 스토리지 추정`을 위한 요구사항을 구체화 해야 합니다.

따라서 개인적으로 아래의 순서에 맞춰서 요구사항을 받는 것이 중요하다고 생각합니다.

1. 도메인에 대한 간단한 질의 응답
2. 해당 도메인의 코어 로직에 대한 CAP 논의
3. 지연 시간 및 내결함성에 대한 논의
4. 총 사용자, 일 사용자, 초당 요청 수, 총 요청 수에 대한 정보

## 1.2. 실제 접근

### 1.2.1. 도메인에 대한 간단한 질의 응답

`주변 친구`는 **주변에 있는** 친구 목록과 그 거리를 보여주는 서비스 입니다. <br>

주변에 있는 기준은 **5km**로 하며 모든 이동 정보는 로그 형태로 아카이빙 되어야 합니다.

아카이빙의 목적은 향후 머신러닝에 쓰이기 위함입니다.

> 이 과정으로 알게된 부분은 다음과 같습니다. <br>
> 1. 대량의 삽입/조회 기능이 발생할 것으로 추정됩니다.
> 2. 아카이빙되고 오래된 데이터는 일정 시간 후 백업 후 휘발 시켜도 무방합니다.

### 1.2.2. 해당 도메인의 코어 로직에 대한 CAP 논의

CAP 정리에 따르면 `데이터 일관성(Consistency)`와 `시스템 가용성(Availability)` 중에 선택해야 합니다.

여기서는 시스템 가용성을 선택하며 이에 따라서 `AP 정리`에 맞춰서 시스템을 설계해야 한다.

시스템의 가용성을 보장하기 위해서 다소간의 일관성(Consistency)는 희생합니다.

### 1.2.3. 지연 시간 및 내결함성에 대한 논의

도메인의 특성상 `저 지연시간(Low-Latency)`의 요구사항을 가지게 됩니다. <br>

30초 마다 대량 데이터 갱신을 하기 위해서는 지연시간 자체가 매우 낮아야 합니다. <br>

일반적으로 인-메모리 DB 제품군을 사용할 확률이 높아지며 이에 따라서 `데이터 내구성(Durabtiliy)`은 다소 포기합니다.


### 1.2.4. 총 사용자, 일 사용자, 초당 요청수, 총 요청 수에 대한 정보

전체 유저 수는 10억, 실제 사용자 수는 1억 (10%)입니다. <br>
실제 사용자 수 1억, 동시간 접속자 수는 1000만 (10%)입니다.

친구 목록은 몇초마다 조회되지만, 친구 위치 정보는 30초마다 갱신됩니다. <br>
따라서 초당 요청 수인 `QPS`는 1000만/33초 = `33만 4천`임을 손쉽게 계산할 수 있습니다.